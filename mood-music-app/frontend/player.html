<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Player — Mind Melody</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --bg-a:#071022;
      --bg-b:#0b1e33;
      --neon1:#9b5cff;
      --neon2:#5be7ff;
      --soft:#0e2333;
      --muted:rgba(230,250,255,0.75);
      --glass: rgba(255,255,255,0.03);
      --radius:16px;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-a),var(--bg-b));color:#eafcff;font-family:Inter,system-ui,Arial}
    .page-wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:22px 16px 110px}
    .top-bar{width:100%;max-width:820px;display:flex;align-items:center;gap:12px;justify-content:flex-start;margin-bottom:18px}
    .back-btn{
      background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0.1));
      border-radius:12px;padding:8px 10px;border:1px solid rgba(255,255,255,0.04);color:var(--muted);box-shadow:0 8px 24px rgba(2,8,18,0.6);display:inline-flex;align-items:center;gap:8px;text-decoration:none;
    }
    .player-card{width:100%;max-width:820px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.04));border-radius:18px;padding:22px;border:1px solid var(--glass);box-shadow:0 24px 60px rgba(2,8,18,0.6)}
    .art-wrap{display:flex;justify-content:center;margin-bottom:18px}
    .album-art{width:72vw;max-width:420px;height:72vw;max-height:420px;border-radius:20px;object-fit:cover;box-shadow:0 30px 80px rgba(27,40,70,0.6);border:1px solid rgba(255,255,255,0.04)}
    @media (max-width:576px){ .album-art{width:88vw;height:88vw} }
    .meta{display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:14px}
    .song-title{font-size:1.25rem;font-weight:700}
    .song-artist{color:var(--muted);font-size:.95rem}
    .progress-row{display:flex;align-items:center;gap:12px;width:100%;margin:10px 0}
    .time{font-size:.85rem;color:var(--muted);min-width:44px;text-align:center}
    .progress{
      -webkit-appearance:none;appearance:none;height:8px;border-radius:10px;background:linear-gradient(90deg,#082533,#0c1f2b);flex:1;border:1px solid rgba(255,255,255,0.025);
      outline:none;position:relative;
    }
    .progress::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:linear-gradient(90deg,var(--neon1),var(--neon2));box-shadow:0 6px 22px rgba(91,231,255,0.12);border:2px solid rgba(255,255,255,0.06);cursor:pointer}
    .controls{display:flex;align-items:center;justify-content:center;gap:14px;margin-top:6px}
    .ctrl-btn{
      width:54px;height:54px;border-radius:14px;border:0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));display:inline-flex;align-items:center;justify-content:center;color:var(--neon2);font-size:20px;cursor:pointer;
      box-shadow: 0 10px 30px rgba(2,8,18,0.6);transition:transform .14s ease, box-shadow .14s;
    }
    .ctrl-btn:hover{transform:translateY(-6px);box-shadow:0 22px 60px rgba(6,40,50,0.6)}
    .play-btn{width:72px;height:72px;border-radius:18px;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#021320;font-size:26px;box-shadow:0 18px 48px rgba(91,231,255,0.12)}
    .small-ctrl{width:44px;height:44px;border-radius:12px;font-size:18px}
    .extra-controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:12px}
    .icon-muted{color:var(--muted)}
    .repeat.active,.shuffle.active{background:linear-gradient(135deg, rgba(155,92,255,0.12), rgba(91,231,255,0.08));color:#021320}
    footer{width:100%;max-width:820px;margin-top:18px;text-align:center;color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="top-bar">
      <a id="backHome" class="back-btn" href="index.html" title="Back to Home">
        <i class="bi bi-arrow-left"></i><span class="d-none d-sm-inline">Back</span>
      </a>
    </div>

    <section class="player-card" aria-label="Music player">
      <div class="art-wrap">
        <img id="albumArt" class="album-art" src="assets/covers/placeholder.jpg" alt="Album art">
      </div>

      <div class="meta text-center">
        <div id="songTitle" class="song-title">No song selected</div>
        <div id="songArtist" class="song-artist">—</div>
      </div>

      <div class="progress-row">
        <div id="currentTime" class="time">0:00</div>
        <input id="progressBar" class="progress" type="range" min="0" max="100" value="0" />
        <div id="durationTime" class="time">0:00</div>
      </div>

      <div class="controls">
        <button id="prevBtn" class="ctrl-btn small-ctrl" title="Previous"><i class="bi bi-skip-start-fill"></i></button>
        <button id="shuffleBtn" class="ctrl-btn small-ctrl" title="Shuffle"><i class="bi bi-shuffle"></i></button>

        <button id="playBtn" class="play-btn" title="Play / Pause"><i id="playIcon" class="bi bi-play-fill"></i></button>

        <button id="repeatBtn" class="ctrl-btn small-ctrl" title="Repeat"><i class="bi bi-arrow-repeat"></i></button>
        <button id="nextBtn" class="ctrl-btn small-ctrl" title="Next"><i class="bi bi-skip-end-fill"></i></button>
      </div>

      <div class="extra-controls text-center">
        <small class="icon-muted">Use the mini-player on the homepage to queue songs</small>
      </div>
    </section>

    <footer>© Mind Melody — Play music that matches your mood</footer>
  </div>

  <!-- minimal player wiring; your app.js/player.js can replace or extend this -->
  <audio id="playerAudio" preload="metadata"></audio>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // minimal interactivity — replace with your app's player.js logic
    const audio = document.getElementById('playerAudio');
    const playBtn = document.getElementById('playBtn');
    const playIcon = document.getElementById('playIcon');
    const progressBar = document.getElementById('progressBar');
    const currentTime = document.getElementById('currentTime');
    const durationTime = document.getElementById('durationTime');
    const albumArt = document.getElementById('albumArt');
    const titleEl = document.getElementById('songTitle');
    const artistEl = document.getElementById('songArtist');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const repeatBtn = document.getElementById('repeatBtn');

    // example hookup: if opened from homepage with query ?song=TITLE&artist=ARTIST&mood=MOOD
    const params = new URLSearchParams(location.search);
    const qSong = params.get('song');
    const qArtist = params.get('artist');
    const qMood = params.get('mood');

    if (qSong) {
      titleEl.textContent = decodeURIComponent(qSong);
      if (qArtist) {
        artistEl.textContent = decodeURIComponent(qArtist);
      }
      // set a demo preview if available (your app should populate real preview)
      audio.src = '';
    } else if (qMood) {
      // If no specific song, show mood-based playlist
      titleEl.textContent = decodeURIComponent(qMood) + ' Mix';
      artistEl.textContent = 'Mood-based playlist';
      // Update page title
      document.title = decodeURIComponent(qMood) + ' Mix — Mind Melody';
      // set a demo preview if available (your app should populate real preview)
      audio.src = '';
    }

    function secToTime(s){
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s/60); const ss = String(s%60).padStart(2,'0');
      return m + ':' + ss;
    }

    playBtn.addEventListener('click', ()=>{
      if (!audio.src) return;

      // Track mood play when user starts playing
      if (qMood) {
        fetch('/api/moods/track-play', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            moodType: qMood,
            songTitle: titleEl.textContent,
            sessionId: localStorage.getItem('mindmelody_session_id') || (localStorage.setItem('mindmelody_session_id', Date.now() + '-' + Math.random().toString(36).substr(2, 9)), localStorage.getItem('mindmelody_session_id'))
          })
        }).catch(e => console.warn('Failed to track mood play:', e));
      }

      if (audio.paused) {
        audio.play().catch(()=>{});
        playIcon.className='bi bi-pause-fill';
      } else {
        audio.pause();
        playIcon.className='bi bi-play-fill';
      }
    });

    audio.addEventListener('loadedmetadata', ()=>{
      progressBar.max = Math.floor(audio.duration);
      durationTime.textContent = secToTime(audio.duration);
    });
    audio.addEventListener('timeupdate', ()=>{
      progressBar.value = Math.floor(audio.currentTime);
      currentTime.textContent = secToTime(audio.currentTime);
    });
    progressBar.addEventListener('input', (e)=> {
      audio.currentTime = Number(e.target.value);
    });

    prevBtn.addEventListener('click', ()=>{ /* wire to your playlist */ });
    nextBtn.addEventListener('click', ()=>{ /* wire to your playlist */ });
    shuffleBtn.addEventListener('click', ()=> shuffleBtn.classList.toggle('active'));
    repeatBtn.addEventListener('click', ()=> repeatBtn.classList.toggle('active'));
  </script>
</body>
</html>